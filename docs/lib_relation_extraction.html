---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/lib_relation_extraction.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/lib_relation_extraction.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TextSpan</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="o">=</span> <span class="n">span</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_index</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_index</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sentence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">text</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">start_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">start</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">end_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">end</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentence</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">sentence</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_index</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_index</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_index</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_index</span>

    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">min_start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_index</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">start_index</span><span class="p">)</span>
        <span class="n">max_end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_index</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">end_index</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">TextSpan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">min_start</span><span class="p">:</span><span class="n">max_end</span><span class="p">])</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes the subset of the start_index, end_index</span>
<span class="sd">    start_index - the starting index of the subset, relative</span>
<span class="sd">    to the spans parent document</span>

<span class="sd">    end_index - the ending index of the subset, relative </span>
<span class="sd">    to the spans partner document</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">def</span> <span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_index</span><span class="p">,</span> <span class="n">end_index</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">TextSpan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">])</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns true if the given span intersects with this span.</span>
<span class="sd">    False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_index</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">start_index</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_index</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">end_index</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_index</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">start_index</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_index</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">end_index</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">start_index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_index</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">start_index</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_index</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">end_index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_index</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">end_index</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_index</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
        
        
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Relation" class="doc_header"><code>class</code> <code>Relation</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L12" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Relation</code>(<strong><code>left_phrase</code></strong>, <strong><code>relation_phrase</code></strong>, <strong><code>right_phrase</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RelationCollection" class="doc_header"><code>class</code> <code>RelationCollection</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L39" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RelationCollection</code>(<strong><code>relations</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="construct_text_spans" class="doc_header"><code>construct_text_spans</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L61" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>construct_text_spans</code>(<strong><code>doc</code></strong>, <strong><code>matches</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_relations" class="doc_header"><code>extract_relations</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L67" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_relations</code>(<strong><code>doc</code></strong>)</p>
</blockquote>
<p>extracts the complete relations from the doc</p>
<p>Args:
    doc ([type]): [description]</p>
<p>Returns:
    [Relation]: the complete set of relations found from the documentation</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_relation_spans" class="doc_header"><code>get_relation_spans</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_relation_spans</code>(<strong><code>doc</code></strong>)</p>
</blockquote>
<p>extracts the complete relations from the doc</p>
<p>Args:
    doc (Document): the document we are using to gather
    the middle portion of the relations</p>
<p>Returns:
    [Relation]: the complete set of relations found from the documentation</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_verbs" class="doc_header"><code>get_verbs</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L124" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_verbs</code>(<strong><code>doc</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_nearest_pattern" class="doc_header"><code>find_nearest_pattern</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L135" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_nearest_pattern</code>(<strong><code>doc</code></strong>, <strong><code>pattern</code></strong>, <strong><code>text_span</code></strong>, <strong><code>search_before</code></strong>)</p>
</blockquote>
<p>Find in doc, the nearest pattern to the given text_span,
returns the result as a TextSpan</p>
<p>Args:
    doc (spacy Document) the document in spacy we are looking for
    pattern (the pattern array to search for): the array of patterns we are
    looking for
    text_span (TextSpan): describes where in the document the word or phrase is
    search_before (bool): if true, then we want to find the nearest pattern that occurs,
            before text_span. Otherwise finds the nearest pattern after text_span</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="merge_overlapping_consecutive_word_span" class="doc_header"><code>merge_overlapping_consecutive_word_span</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L170" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>merge_overlapping_consecutive_word_span</code>(<strong><code>text_spans</code></strong>)</p>
</blockquote>
<p>Merges two spans into one span iff they are
consecutive end_index=start_index or they overlap</p>
<p>Applies to all in order.</p>
<p>Args:
    text_spans ([type]): the span containing the word</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_latest_span" class="doc_header"><code>find_latest_span</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L215" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_latest_span</code>(<strong><code>text_spans</code></strong>)</p>
</blockquote>
<p>Finds the latest occuring span in given
set of text_spans</p>
<p>Args:
    text_spans (TextSpan): the span of text according to some document</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_earliest_span" class="doc_header"><code>find_earliest_span</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L228" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_earliest_span</code>(<strong><code>text_spans</code></strong>)</p>
</blockquote>
<p>Finds the span that is the "earliest occuriing", i.e. the
smallest start index</p>
<p>Args:
    text_spans ([type]): the smallest match on the text span</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_longest_span" class="doc_header"><code>find_longest_span</code><a href="https://github.com/pmaxit/tfbook_pages/tree/master/tfbook_pages/relation_extraction.py#L242" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_longest_span</code>(<strong><code>text_spans</code></strong>)</p>
</blockquote>
<p>find the longest match</p>
<p>Args:
    text_spans ([TextSpan]): the set of matches we are filtering</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;en_core_web_sm&#39;</span><span class="p">)</span>

<span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">In July 2012, Ancestry.com found a strong likelihood that Dunham was descended from John Punch</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">matcher</span> <span class="o">=</span> <span class="n">Matcher</span><span class="p">(</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">)</span>


<span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">relations</span> <span class="o">=</span> <span class="n">extract_relations</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">IndexError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_2342432/4243624954.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>relations <span class="ansi-blue-fg">=</span> extract_relations<span class="ansi-blue-fg">(</span>doc<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/ipykernel_2342432/213462609.py</span> in <span class="ansi-cyan-fg">extract_relations</span><span class="ansi-blue-fg">(doc)</span>
<span class="ansi-green-intense-fg ansi-bold">     68</span>         <span class="ansi-blue-fg">[</span>Relation<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span> the complete set of relations found <span class="ansi-green-fg">from</span> the documentation
<span class="ansi-green-intense-fg ansi-bold">     69</span>     &#34;&#34;&#34;
<span class="ansi-green-fg">---&gt; 70</span><span class="ansi-red-fg">     </span>relation_spans <span class="ansi-blue-fg">=</span> get_relation_spans<span class="ansi-blue-fg">(</span>doc<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     71</span>     noun_phrase_pattern <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">&#34;POS&#34;</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">&#34;NOUN&#34;</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">&#34;POS&#34;</span><span class="ansi-blue-fg">:</span> <span class="ansi-blue-fg">&#34;PROPN&#34;</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">&#34;POS&#34;</span><span class="ansi-blue-fg">:</span> <span class="ansi-blue-fg">&#34;PRON&#34;</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     72</span> 

<span class="ansi-green-fg">/tmp/ipykernel_2342432/213462609.py</span> in <span class="ansi-cyan-fg">get_relation_spans</span><span class="ansi-blue-fg">(doc)</span>
<span class="ansi-green-intense-fg ansi-bold">    108</span>     relation_spans <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    109</span>     <span class="ansi-green-fg">for</span> verb <span class="ansi-green-fg">in</span> verbs<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 110</span><span class="ansi-red-fg">         </span>verb_spans <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>span <span class="ansi-green-fg">for</span> span <span class="ansi-green-fg">in</span> syntactical_constraint_matches <span class="ansi-green-fg">if</span> verb <span class="ansi-green-fg">in</span> span<span class="ansi-blue-fg">.</span>text<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    111</span>         joined_spans <span class="ansi-blue-fg">=</span> merge_overlapping_consecutive_word_span<span class="ansi-blue-fg">(</span>verb_spans<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    112</span>         longest_span <span class="ansi-blue-fg">=</span> find_longest_span<span class="ansi-blue-fg">(</span>joined_spans<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/tmp/ipykernel_2342432/213462609.py</span> in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">    108</span>     relation_spans <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    109</span>     <span class="ansi-green-fg">for</span> verb <span class="ansi-green-fg">in</span> verbs<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 110</span><span class="ansi-red-fg">         </span>verb_spans <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>span <span class="ansi-green-fg">for</span> span <span class="ansi-green-fg">in</span> syntactical_constraint_matches <span class="ansi-green-fg">if</span> verb <span class="ansi-green-fg">in</span> span<span class="ansi-blue-fg">.</span>text<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    111</span>         joined_spans <span class="ansi-blue-fg">=</span> merge_overlapping_consecutive_word_span<span class="ansi-blue-fg">(</span>verb_spans<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    112</span>         longest_span <span class="ansi-blue-fg">=</span> find_longest_span<span class="ansi-blue-fg">(</span>joined_spans<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">span.pyx</span> in <span class="ansi-cyan-fg">spacy.tokens.span.Span.text.__get__</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">span.pyx</span> in <span class="ansi-cyan-fg">spacy.tokens.span.Span.text_with_ws.__get__</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">span.pyx</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">span.pyx</span> in <span class="ansi-cyan-fg">spacy.tokens.span.Span._recalculate_indices</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">IndexError</span>: [E037] Error calculating span: Can&#39;t find a token ending at character offset 33.</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">debug</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&gt; <span class="ansi-green-fg">/tmp/ipykernel_2342432/1624006205.py</span>(152)<span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">    150 </span><span class="ansi-red-fg">    </span>spans_to_search <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">    151 </span><span class="ansi-red-fg">    </span><span class="ansi-green-fg">if</span> search_before<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 152 </span><span class="ansi-red-fg">        </span>spans_to_search <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>span <span class="ansi-green-fg">for</span> span <span class="ansi-green-fg">in</span> sorted_spans <span class="ansi-green-fg">if</span> span<span class="ansi-blue-fg">.</span>start_index <span class="ansi-blue-fg">&lt;</span> text_span<span class="ansi-blue-fg">.</span>start_index<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">    153 </span><span class="ansi-red-fg">        </span>spans_to_search<span class="ansi-blue-fg">.</span>reverse<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">    154 </span>

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

